<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>pierce homepage</title>
    <link href="//cdn.bootcss.com/bootstrap/4.0.0-alpha.3/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body{margin:0}
        canvas{
            background-color: #6699CC;
        }
        #bottom {
            position: absolute;
            bottom: 60%;
            margin-left: 21%;
            width: 60%;
            z-index: 100;
        }

        #left-switch {
            float: left;
        }

        #right-switch {
            float: right;
        }

        .switch {
            width: 90px;
            height: 90px;
            -webkit-border-radius: 45px;
            -moz-border-radius: 45px;
            border-radius: 45px;
            text-align: center;
            padding-top: 10px;
            font-size: 2.5em;
            color: #ccffcc;
            background-color: dimgrey;
        }

        .switch:hover {
            background-color: darkslategray;
            cursor: pointer;
        }
    </style>
    <script>
        window.onload = init;
        var wHeight = window.innerHeight;
        var wWidth = window.innerWidth;
        //用极坐标表示点的位置
        var globalData = [];

        var squareData = [
            [200, -Math.PI*0.75],
            [200, -Math.PI*0.25],
            [200, Math.PI*0.25],
            [200, Math.PI*0.75]
        ];

        var triangleData = [
            [200, -Math.PI*0.5],
            [200, Math.PI / 6],
            [200, Math.PI * 5.0 / 6]
        ];

        var concaveData = [
            [300, -Math.PI*0.75],
            [100, -Math.PI*0.75],
            [100, Math.PI*0.75],
            [100, Math.PI*0.25],
            [100, -Math.PI*0.25],
            [300, -Math.PI*0.25],
            [300, Math.PI*0.25],
            [300, Math.PI*0.75]
        ];

        globalData[0] = squareData;
        globalData[1] = triangleData;
        globalData[2] = concaveData;
        globalData[3] = [];

        var globalIndex = 0;

        function init() {
            var canvas = $("#canvas");
            canvas.height = wHeight;
            canvas.width = wWidth;
            
            var data = globalData[0];
            
            var ctx = canvas.getContext('2d');

            ctx.fillStyle = '#cccc66';
            
            var cx = wWidth/2, cy = wHeight/2;
            
            var theta = 0;
            var angleSpeed = 0.02;

            var mx=wWidth/2, my=wHeight/2; //mouse position

            draw();

            function draw() {

                ctx.clearRect(0, 0, wWidth, wHeight);
                ctx.beginPath();

                var _len = data.length;
                if(_len >1) {
                    ctx.moveTo(P(0)[0], P(0)[1]);
                    for(var i=1;i<_len;i++) {
                        ctx.lineTo(P(i)[0], P(i)[1]);
                    }
                    ctx.fill();
                }

                ctx.closePath();

                adjust();

                requestAnimationFrame(draw);
            }

            document.addEventListener('mousemove', function(e) {
                mx = e.clientX;
                my = e.clientY;

            });

            //水平直线与AB线段的交点的x坐标，没有交点则返回null
            function xSegment(y0, x1, y1, x2, y2) {
                if(y1>y0 && y2 > y0) return null;
                if(y1 < y0 && y2 < y0) return null;
                //如果是水平线段，返回线段上任一点
                if(y1 == y2) {
                    return x1;
                } else {
                    return (y0-y1)*(x2-x1) / (y2-y1) + x1;
                }
            }

            function ptop(x1, y1, x2, y2) {
                return Math.sqrt(
                        (x1-x2)*(x1-x2) + (y1-y2)*(y1-y2)
                );
            }

            function adjust() {

                theta += angleSpeed;

                var _left = 0;
                var _right = 0;
                var _len = data.length;

                //判断点是否在多边形内部
                for(var i=0; i<_len; i++) {
                    var _res = xSegment(my, P(i)[0], P(i)[1], P((i+1)%_len)[0], P((i+1)%_len)[1]);
                    if(_res != null) {
                        _res < mx ? _left++ : _right ++;
                    }
                }
                if(_left&1 && _right&1) {
                    ctx.fillStyle = '#cc6666';
                } else {
                    ctx.fillStyle = '#cccc66';
                }

            }

            //极坐标转换成笛卡尔坐标
            function P(i) {
                var _alpha = data[i][1];
                var _x = data[i][0] * Math.cos(_alpha+theta);
                var _y = data[i][0] * Math.sin(_alpha+theta);
                return [cx+_x, cy+_y];
            }

            window.onresize = function() {
                wHeight = window.innerHeight;
                wWidth = window.innerWidth;
                canvas.height = wHeight;
                canvas.width = wWidth;
                cx = wWidth/2; cy = wHeight/2;
            };

            var leftEye = $("#left-switch");
            leftEye.onclick = function(e) {
                globalIndex--; if(globalIndex<0)globalIndex = globalData.length-1;
                if(globalIndex == 3) {
                    globalData[3] = getRandomShape();
                }
                data = globalData[globalIndex];
            };
            var rightEye = $("#right-switch");
            rightEye.onclick = function(e) {
                globalIndex++; if(globalIndex>=globalData.length) globalIndex = 0;
                if(globalIndex == 3) {
                    globalData[3] = getRandomShape();
                }
                data = globalData[globalIndex];
            };
        }

        function getRandomShape() {
            return [
                [Math.random()*300, (Math.random()-0.5)*Math.PI*2],
                [Math.random()*300, (Math.random()-0.5)*Math.PI*2],
                [Math.random()*300, (Math.random()-0.5)*Math.PI*2],
                [Math.random()*300, (Math.random()-0.5)*Math.PI*2],
                [Math.random()*300, (Math.random()-0.5)*Math.PI*2],
                [Math.random()*300, (Math.random()-0.5)*Math.PI*2],
                [Math.random()*300, (Math.random()-0.5)*Math.PI*2],
                [Math.random()*300, (Math.random()-0.5)*Math.PI*2]
            ];
        }
        function $(tag) {
            if(tag == null || tag == undefined ) {
                return 0;
            }
            if(tag.length == 0) return 0;
            if(tag[0] == '#') {
                var id = tag.substr(1, tag.length-1);
                return document.getElementById(id);
            }
        }


    </script>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="bottom">
        <div class="switch" id="left-switch">
            <div class="pupil"></div>
        </div>
        <div class="switch" id="right-switch">
            <div class="pupil"></div>
        </div>
    </div>
</body>