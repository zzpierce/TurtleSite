<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>pierce homepage</title>
    <style>
        body{margin:0}
        canvas{
            background-color: #66CCFF;
        }
    </style>
    <script>
        window.onload = init;
        var wHeight = window.innerHeight;
        var wWidth = window.innerWidth;

        function init() {
            var canvas = $("#canvas");
            canvas.height = wHeight;
            canvas.width = wWidth;

            var ctx = canvas.getContext('2d');

            var cx1= 100, cy1 = 100;
            var cx2 = wWidth/2, cy2 = wHeight/2;

            var radius = 50;

            var mx=wWidth/2, my=wHeight/2; //mouse position

            var sx1=0, sy1=0, sx2=0, sy2=0; //speed vector

            var slow = 0.98;
            draw();

            function draw() {

                ctx.clearRect(0, 0, wWidth, wHeight);
                ctx.beginPath();
                ctx.fillStyle = '#337799';
                ctx.arc(cx1, cy1, radius, 0, Math.PI * 2);
                ctx.fill();
                ctx.closePath();
                ctx.beginPath();
                ctx.fillStyle = '#cccc66';
                ctx.fillRect(cx2-2*radius, cy2-2*radius, radius*4, radius*4);
                ctx.closePath();

                adjust();
                requestAnimationFrame(draw);
            }

            function ptop(x1, y1, x2, y2) {
                return Math.sqrt(
                        (x1-x2)*(x1-x2) + (y1-y2)*(y1-y2)
                );
            }

            //x1 to x2
            function getDirection(x1, y1, x2, y2) {
                var _len = ptop(x1, y1, x2, y2);
                return [(x2-x1)/_len, (y2-y1)/_len];
            }

            function adjust() {
                var d = getDirection(cx1, cy1, mx, my);
                sx1 += d[0];
                sy1 += d[1];

                cx1 += sx1;
                cy1 += sy1;
                sx1 *= slow;
                sy1 *= slow;

            }

            function ifCrash() {
                if(isCrash()) {

                    //如果两个球的运动方向是在互相远离，则不用判断碰撞
                    if(pMulti(sx1, sy1, cx2-cx1, cy2-cy1) <= 0
                        && pMulti(sx2, sy2, cx1-cx2, cy1-cy2) <= 0) return;

                    var _dx = cx2 - cx1;
                    var _dy = cy2 - cy1;

                    //调整位置，防止两球重叠
                    var _dlen = Math.sqrt( _dx*_dx + _dy*_dy );
                    cx1 = cx2 - _dx * (radius) * 2 / _dlen;
                    cy1 = cy2 - _dy * (radius) * 2 / _dlen;

                    //利用向量公式计算碰撞后的方向
                    var uv = sx1*_dx + sy1*_dy;
                    var vLen = ptop(0, 0, _dx, _dy);
                    var scale = uv / (vLen * vLen);
                    var _addx2 = scale * _dx;
                    var _addy2 = scale * _dy;

                    sx1 = sx1 - _addx2;
                    sy1 = sy1 - _addy2;

                    sx2 += _addx2;
                    sy2 += _addy2;

                }
            }

            //向量点乘
            function pMulti(x1, y1, x2, y2 ){
                return x1*x2 + y1*y2;
            }

            //相撞
            function isCrash() {
                return ptop(cx1, cy1, cx2, cy2) <= radius * 2;
            }

            //球撞到边缘
            function hitBorder() {
                if(cx2+radius >= wWidth && sx2 > 0) sx2 = -sx2;
                if(cx2-radius <=0 && sx2 < 0) sx2 = -sx2;
                if(cy2+radius >= wHeight && sy2 > 0) sy2 = -sy2;
                if(cy2-radius <=0 && sy2 < 0) sy2 = -sy2;
            }

            document.addEventListener('mousemove', function(e) {
                mx = e.clientX;
                my = e.clientY;
            });

            window.onresize = function() {
                wHeight = window.innerHeight;
                wWidth = window.innerWidth;
                canvas.height = wHeight;
                canvas.width = wWidth;
                cx2 = wWidth/2; cy2 = wHeight/2;
            };


        }

        function $(tag) {
            if(tag == null || tag == undefined ) {
                return 0;
            }
            if(tag.length == 0) return 0;
            if(tag[0] == '#') {
                var id = tag.substr(1, tag.length-1);
                return document.getElementById(id);
            }
        }
    </script>
</head>
<body>
    <canvas id="canvas"></canvas>
</body>