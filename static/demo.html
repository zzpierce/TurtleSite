<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>pierce homepage</title>
    <script>
        window.onload = init;
        var wHeight = window.innerHeight;
        var wWidth = window.innerWidth;

        function init() {
            var canvas = $("#canvas");
            canvas.height = wHeight;
            canvas.width = wWidth;

            var ctx = canvas.getContext('2d');

            ctx.fillStyle = '#336699';

            var bx = 100, by = 100;
            var dx,dy;
            var side = 100;

            var cx = 500, cy =350;
            var cRadius = 50;

            var diff = 0.1;

            draw();

            function draw() {

                ctx.beginPath();
                ctx.clearRect(0, 0, wWidth, wHeight);
                ctx.fillRect(bx, by, side, side);
                ctx.arc(cx, cy, cRadius, 0, Math.PI*2 );
                ctx.fill();
                ctx.closePath();
                requestAnimationFrame(draw);

            }

            var isDrag = false;
            document.addEventListener('mousedown', function(e) {
                var mx = e.clientX;
                var my = e.clientY;

                dx = mx - bx; dy = my - by;
                if(dx >=0 && dy >= 0 && dx <100 && dy < 100) {
                    isDrag = true;
                }

            });

            document.addEventListener('mousemove', function(e) {
                var mx = e.clientX;
                var my = e.clientY;

                if (isDrag && isDuang() ) {
                    bx = mx - dx; by = my - dy;
                }

                function isDuang() {
                    var _dhold = cRadius + diff;
                    var _dp1 = ptop(bx, by, cx, cy);
                    if(_dp1 <= cRadius) {
                        //P1 Duang
                        var _dx = (bx - cx) * _dhold / _dp1;
                        var _dy = (by - cy) * _dhold / _dp1;

                        bx = cx + _dx;
                        by = cy + _dy;
                        return false;
                    }

                    return true;
                }
            });

            document.addEventListener('mouseup', function(e) {
                var mx = e.clientX;
                var my = e.clientY;

                isDrag = false;
            });
        }



        function $(tag) {
            if(tag == null || tag == undefined ) {
                return 0;
            }
            if(tag.length == 0) return 0;
            if(tag[0] == '#') {
                var id = tag.substr(1, tag.length-1);
                return document.getElementById(id);
            }
        }

        function ptop(x1, y1, x2, y2) {
            var dis = Math.sqrt(
                    (x2-x1)*(x2-x1) + (y2-y1)*(y2-y1)
            );
            console.log(dis);
            return dis;
        }

        function ptol(px, py, lx1, ly1, lx2, ly2) {
            var k = (ly2-ly1)/(lx2-lx1);
            var b =  (lx1*ly2 - lx2*ly1) / (x1-x2);

            return (k*px - py + b) / (Math.sqrt(k*k+1));
        }

    </script>
</head>
<body>
    <canvas id="canvas"></canvas>
</body>